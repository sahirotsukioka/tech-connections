<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Tech Connections</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA ç”¨ -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#020617" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <style>
    /* ===== èƒŒæ™¯ï¼šmacOS Sonomaã£ã½ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ===== */
    body {
      margin: 0;
      padding: 24px;
      font-family: system-ui, -apple-system, "SF Pro Text", BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background:
        radial-gradient(circle at 10% 20%, rgba(255, 163, 234, 0.55) 0, transparent 40%),
        radial-gradient(circle at 80% 0%, rgba(125, 211, 252, 0.60) 0, transparent 45%),
        radial-gradient(circle at 0% 80%, rgba(251, 191, 36, 0.55) 0, transparent 45%),
        radial-gradient(circle at 90% 90%, rgba(248, 113, 113, 0.65) 0, transparent 55%),
        radial-gradient(circle at 50% 50%, #020617 0, #020617 100%);
      color: #f1f5f9;
      box-sizing: border-box;
    }

    * {
      box-sizing: inherit;
    }

    /* ===== ä¸­å¤®ã‚«ãƒ¼ãƒ‰ï¼šiOS 17 ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé¢¨ ===== */
    .app {
      width: min(600px, 100%);
      background: radial-gradient(circle at top left,
                  rgba(255, 255, 255, 0.16),
                  rgba(15, 23, 42, 0.9));
      backdrop-filter: blur(26px);
      -webkit-backdrop-filter: blur(26px);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.22);
      box-shadow:
        0 30px 80px rgba(15, 23, 42, 0.9),
        inset 0 0 0 0.5px rgba(255, 255, 255, 0.18);
      padding: 18px 18px 20px;
      color: #e5e7eb;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 12px;
      flex-wrap: wrap;
    }

    h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 13px;
      color: #9ca3af;
      margin: 2px 0 6px;
    }

    .puzzle-meta {
      font-size: 12px;
      color: #cbd5f5;
      margin-bottom: 10px;
    }

    .tag {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #cbd5f5;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* ===== ãƒœãƒ¼ãƒ‰ ===== */
    .board {
      display: grid;
      grid-template-columns: repeat(4, minmax(90px, 1fr));
      gap: 10px;
      margin-bottom: 14px;
    }

    /* ===== ã‚¿ã‚¤ãƒ«ï¼ˆiOSã‚¬ãƒ©ã‚¹ï¼‹è§’ä¸¸24pxï¼‰ ===== */
    .tile {
      background: rgba(15, 23, 42, 0.55);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 14px 10px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      color: #f9fafb;
      transition:
        transform 0.14s ease-out,
        border-color 0.14s ease-out,
        background 0.14s ease-out,
        box-shadow 0.14s ease-out,
        opacity 0.14s ease-out;
      box-shadow:
        0 10px 26px rgba(15, 23, 42, 0.85),
        0 0 0 0.5px rgba(15, 23, 42, 0.9);
    }

    .tile:hover {
      transform: translateY(-1px);
      border-color: rgba(248, 250, 252, 0.75);
      background: rgba(30, 64, 175, 0.35);
      box-shadow:
        0 14px 34px rgba(15, 23, 42, 0.95),
        0 0 0 0.5px rgba(191, 219, 254, 0.3);
    }

    .tile.selected {
      background: rgba(0, 113, 227, 0.55); /* Apple Blue */
      border-color: rgba(191, 219, 254, 0.9);
      box-shadow:
        0 16px 40px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(0, 113, 227, 0.85);
      transform: translateY(-1px);
    }

    /* ãƒ­ãƒƒã‚¯å…±é€š */
    .tile.locked {
      cursor: default;
      opacity: 0.96;
    }

    /* ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã®è‰²ï¼ˆ0ã€œ3ï¼‰ */
    .tile.locked.group-0 {
      background: rgba(250, 204, 21, 0.75);   /* Yellow */
      border-color: rgba(254, 240, 138, 0.95);
      box-shadow:
        0 14px 32px rgba(161, 98, 7, 0.7),
        0 0 0 1px rgba(250, 204, 21, 0.9);
    }

    .tile.locked.group-1 {
      background: rgba(34, 197, 94, 0.75);    /* Green */
      border-color: rgba(187, 247, 208, 0.95);
      box-shadow:
        0 14px 32px rgba(21, 128, 61, 0.7),
        0 0 0 1px rgba(34, 197, 94, 0.9);
    }

    .tile.locked.group-2 {
      background: rgba(59, 130, 246, 0.8);    /* Blue */
      border-color: rgba(191, 219, 254, 0.95);
      box-shadow:
        0 14px 32px rgba(30, 64, 175, 0.75),
        0 0 0 1px rgba(59, 130, 246, 0.9);
    }

    .tile.locked.group-3 {
      background: rgba(168, 85, 247, 0.8);    /* Purple */
      border-color: rgba(233, 213, 255, 0.95);
      box-shadow:
        0 14px 32px rgba(109, 40, 217, 0.75),
        0 0 0 1px rgba(168, 85, 247, 0.9);
    }

    /* ===== ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆãƒœã‚¿ãƒ³ï¼‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰ ===== */
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      background: rgba(255, 255, 255, 0.16);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.35);
      padding: 7px 18px;
      font-size: 13px;
      font-weight: 600;
      color: #f9fafb;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.88);
      transition:
        background 0.16s ease-out,
        transform 0.12s ease-out,
        box-shadow 0.16s ease-out,
        border-color 0.16s ease-out;
    }

    .btn:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.26);
      border-color: rgba(255, 255, 255, 0.65);
      transform: translateY(-0.5px);
      box-shadow: 0 14px 34px rgba(15, 23, 42, 0.92);
    }

    .btn:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.8);
    }

    .btn:disabled {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.6);
      border-color: rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(15, 23, 42, 0.8);
      border-color: rgba(226, 232, 240, 0.9);
    }

    .status {
      font-size: 12px;
      color: #e5e7eb;
      min-height: 1.2em;
    }

    .status.ok {
      color: #4ade80;
    }

    .status.err {
      color: #f97373;
    }

    .groups-view {
      margin-top: 10px;
      font-size: 11px;
      color: #cbd5f5;
    }

    .groups-view-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .groups-view ul {
      margin: 4px 0 0;
      padding-left: 16px;
    }

    /* ===== ã‚¹ã‚³ã‚¢ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé¢¨ï¼‰ ===== */
    .score-card {
      margin-top: 12px;
      padding: 10px 12px 12px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.75);
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.8);
      display: none;
    }

    .score-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      flex-wrap: wrap;
    }

    .score-title {
      font-size: 13px;
      font-weight: 600;
    }

    .score-sub {
      font-size: 12px;
      color: #cbd5f5;
    }

    .score-body {
      margin-top: 6px;
      font-size: 12px;
    }

    .score-label {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .score-order {
      line-height: 1.4;
      white-space: pre-line;
    }

    .score-share-btn {
      margin-top: 8px;
      font-size: 12px;
      padding: 5px 14px;
    }

    @media (max-width: 640px) {
      body {
        padding: 12px;
      }
      .app {
        padding: 14px 12px 16px;
        border-radius: 22px;
      }
      .board {
        grid-template-columns: repeat(2, minmax(120px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-header">
      <div>
        <h1 id="appTitle">Tech Connections</h1>
        <p id="subtitle" class="subtitle"></p>
        <div id="meta" class="puzzle-meta"></div>
      </div>
      <div class="tag">
        <span>ï£¿</span><span>Tech Connections</span>
      </div>
    </div>

    <div class="board" id="board"></div>

    <div class="footer">
      <div class="btn-row">
        <button id="checkBtn" class="btn">
          âœ“ ã‚°ãƒ«ãƒ¼ãƒ—ãƒã‚§ãƒƒã‚¯
        </button>
        <button id="resetBtn" class="btn btn-secondary">
          â†» ãƒªã‚»ãƒƒãƒˆï¼ˆä¸¦ã³æ›¿ãˆï¼‰
        </button>
      </div>
      <div id="status" class="status"></div>
    </div>

    <div class="groups-view" id="groupsView"></div>

    <!-- ã‚¹ã‚³ã‚¢ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¯ãƒªã‚¢å¾Œã«è¡¨ç¤ºï¼‰ -->
    <div class="score-card" id="scoreCard" aria-hidden="true">
      <div class="score-header">
        <div class="score-title" id="scoreTitle">ä»Šæ—¥ã®å•é¡Œ</div>
        <div class="score-sub" id="scoreTime">ã‚¯ãƒªã‚¢æ™‚é–“: --</div>
      </div>
      <div class="score-body">
        <div class="score-label">æ­£è§£é †</div>
        <div class="score-order" id="scoreOrder"></div>
      </div>
      <button id="shareBtn" class="btn btn-secondary score-share-btn">
        ç”»åƒã¨ã—ã¦ã‚·ã‚§ã‚¢ç”¨ã«ä¿å­˜
      </button>
    </div>
  </div>

  <script>
    // ===== 1) ãƒ‘ã‚ºãƒ«å®šç¾©ï¼ˆæ—¥æœ¬èªï¼†Podcastï¼‰ =====
    var PUZZLES = [
      {
        id: "apple_history",
        title: "Apple ï¼† ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æ­´å²",
        subtitle: "Appleè£½å“ã¨ä¿å­˜ãƒ¡ãƒ‡ã‚£ã‚¢ã®å¤‰é·ã€‚",
        groups: [
          {
            name: "åˆæœŸAppleè£½å“ï¼ˆ80ã€œ90å¹´ä»£ï¼‰",
            items: ["Lisa", "Macintosh", "Newton", "iMac"]
          },
          {
            name: "ãƒ¢ãƒ€ãƒ³Appleãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ©ã‚¤ãƒ³",
            items: ["iPod", "iPhone", "Watch", "Vision Pro"]
          },
          {
            name: "Appleã‚ã‚‹ã‚ã‚‹å‘½å",
            items: ["Pro", "Mini", "Air", "Plus"]
          },
          {
            name: "ä¿å­˜ãƒ¡ãƒ‡ã‚£ã‚¢ã®æ™‚ä»£",
            items: ["Floppy", "CD-ROM", "Disk", "iCloud"]
          }
        ]
      },
      {
        id: "podcast_production",
        title: "ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆåˆ¶ä½œã‚»ãƒƒãƒˆ",
        subtitle: "åéŒ²ãƒ»ç·¨é›†ãƒ»é…ä¿¡ã¾ã‚ã‚Šã®ç”¨èªã€‚",
        groups: [
          {
            name: "åéŒ²ãƒ»ç·¨é›†ã‚½ãƒ•ãƒˆ",
            items: ["Logic Pro", "GarageBand", "Audition", "DaVinci Resolve"]
          },
          {
            name: "é…ä¿¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ",
            items: ["Spotify", "Apple Podcasts", "YouTube", "Amazon Music"]
          },
          {
            name: "ãƒã‚¤ã‚¯ãƒ»æ©Ÿæã¾ã‚ã‚Š",
            items: ["ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒã‚¤ã‚¯", "ã‚³ãƒ³ãƒ‡ãƒ³ã‚µãƒ¼ãƒã‚¤ã‚¯", "ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹", "ãƒãƒƒãƒ—ã‚¬ãƒ¼ãƒ‰"]
          },
          {
            name: "ç•ªçµ„é‹å–¶ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰",
            items: ["å°æœ¬", "ã‚·ãƒ§ãƒ¼ãƒãƒ¼ãƒˆ", "ãƒãƒ£ãƒ—ã‚¿ãƒ¼", "ã‚µãƒ ãƒã‚¤ãƒ«"]
          }
        ]
      },
      {
        id: "tech_news_podcast",
        title: "ãƒ†ãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹ï¼†ã‚¬ã‚¸ã‚§ãƒƒãƒˆ",
        subtitle: "ãƒ‹ãƒ¥ãƒ¼ã‚¹ç³»ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã«å‡ºã¦ããã†ãªã‚‚ã®ã€‚",
        groups: [
          {
            name: "ãƒ‹ãƒ¥ãƒ¼ã‚¹ç³»ãƒ†ãƒƒã‚¯ãƒ¡ãƒ‡ã‚£ã‚¢",
            items: ["The Verge", "TechCrunch", "WIRED", "Engadget"]
          },
          {
            name: "ã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚«ãƒ†ã‚´ãƒª",
            items: ["ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³", "ã‚¹ãƒãƒ¼ãƒˆã‚¦ã‚©ãƒƒãƒ", "ARãƒ˜ãƒƒãƒ‰ã‚»ãƒƒãƒˆ", "å®Œå…¨ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ã‚¤ãƒ¤ãƒ›ãƒ³"]
          },
          {
            name: "åéŒ²ã‚¹ã‚¿ã‚¤ãƒ«",
            items: ["ãƒªãƒ¢ãƒ¼ãƒˆåéŒ²", "ã‚¹ã‚¿ã‚¸ã‚ªåéŒ²", "ãƒ©ã‚¤ãƒ–é…ä¿¡", "ã‚½ãƒ­ãƒˆãƒ¼ã‚¯"]
          },
          {
            name: "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®å ´",
            items: ["Discord", "YouTubeãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—", "Patreon", "ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼"]
          }
        ]
      }
    ];

    // ===== 2) ä»Šæ—¥ã®ãƒ‘ã‚ºãƒ«ã‚’é¸ã¶ï¼ˆ1æ—¥1å•ï¼‰ =====
    function getTodayPuzzle() {
      var today = new Date();
      var n =
        today.getFullYear() * 10000 +
        (today.getMonth() + 1) * 100 +
        today.getDate();
      var index = n % PUZZLES.length;
      return PUZZLES[index];
    }

    var CURRENT_PUZZLE = getTodayPuzzle();

    // ===== 3) DOMå–å¾— =====
    var boardEl = document.getElementById("board");
    var statusEl = document.getElementById("status");
    var checkBtn = document.getElementById("checkBtn");
    var resetBtn = document.getElementById("resetBtn");
    var subtitleEl = document.getElementById("subtitle");
    var metaEl = document.getElementById("meta");
    var groupsViewEl = document.getElementById("groupsView");

    var scoreCardEl = document.getElementById("scoreCard");
    var scoreTitleEl = document.getElementById("scoreTitle");
    var scoreTimeEl = document.getElementById("scoreTime");
    var scoreOrderEl = document.getElementById("scoreOrder");
    var shareBtn = document.getElementById("shareBtn");

    // ===== 4) çŠ¶æ…‹ =====
    var words = [];
    var selected = [];
    var lockedWords = {}; // word -> groupIndex (0ã€œ3)
    var solvedGroups = {}; // name -> true
    var solveOrder = [];   // æ­£è§£é †ã«ã‚°ãƒ«ãƒ¼ãƒ—åã‚’æ ¼ç´
    var startTime = null;
    var endTime = null;
    var todayLabel = "";

    // ===== 5) åˆæœŸåŒ– =====
    function initPuzzle() {
      subtitleEl.textContent = CURRENT_PUZZLE.subtitle;

      var today = new Date();
      var yyyy = today.getFullYear();
      var mm = String(today.getMonth() + 1);
      if (mm.length < 2) mm = "0" + mm;
      var dd = String(today.getDate());
      if (dd.length < 2) dd = "0" + dd;
      todayLabel = yyyy + "/" + mm + "/" + dd;
      metaEl.textContent = "ä»Šæ—¥ã®ãŠé¡Œï¼š" + todayLabel + " â€“ å…¨4ã‚°ãƒ«ãƒ¼ãƒ—";

      // wordsã‚’ä½œã£ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«
      words = [];
      for (var i = 0; i < CURRENT_PUZZLE.groups.length; i++) {
        var g = CURRENT_PUZZLE.groups[i];
        for (var j = 0; j < g.items.length; j++) {
          words.push(g.items[j]);
        }
      }
      words = shuffle(words);

      // çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
      selected = [];
      lockedWords = {};
      solvedGroups = {};
      solveOrder = [];
      startTime = Date.now();
      endTime = null;

      statusEl.textContent = "4æšãšã¤é¸ã‚“ã§ã€ã‚°ãƒ«ãƒ¼ãƒ—ãƒã‚§ãƒƒã‚¯ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚";
      statusEl.className = "status";

      // ã‚¹ã‚³ã‚¢ã‚«ãƒ¼ãƒ‰éè¡¨ç¤º
      scoreCardEl.style.display = "none";
      scoreCardEl.setAttribute("aria-hidden", "true");
      scoreTitleEl.textContent = "ä»Šæ—¥ã®å•é¡Œ";
      scoreTimeEl.textContent = "ã‚¯ãƒªã‚¢æ™‚é–“: --";
      scoreOrderEl.textContent = "";

      renderGroupsPreview();
      renderBoard();
    }

    // ===== 6) ãƒœãƒ¼ãƒ‰æç”»ï¼ˆãƒ­ãƒƒã‚¯ï¼†é †ç•ªåæ˜ ï¼‰ =====
    function renderBoard() {
      boardEl.innerHTML = "";

      for (var k = 0; k < words.length; k++) {
        var word = words[k];
        var div = document.createElement("div");
        div.className = "tile";
        div.textContent = word;
        div.setAttribute("data-word", word);

        if (lockedWords[word] !== undefined) {
          div.classList.add("locked");
          div.classList.add("group-" + lockedWords[word]);
        } else {
          div.addEventListener("click", onTileClick);
        }

        boardEl.appendChild(div);
      }
    }

    // ===== 7) ã‚¿ã‚¤ãƒ«ã‚¯ãƒªãƒƒã‚¯ =====
    function onTileClick(event) {
      var tile = event.currentTarget;
      var word = tile.getAttribute("data-word");
      if (lockedWords[word] !== undefined) {
        return;
      }

      if (tile.classList.contains("selected")) {
        tile.classList.remove("selected");
        selected = selected.filter(function (w) {
          return w !== word;
        });
      } else {
        if (selected.length >= 4) {
          return;
        }
        tile.classList.add("selected");
        selected.push(word);
      }

      statusEl.textContent = "";
      statusEl.className = "status";
    }

    // ===== 8) ã‚°ãƒ«ãƒ¼ãƒ—ãƒã‚§ãƒƒã‚¯ =====
    checkBtn.addEventListener("click", function () {
      var count = selected.length;
      if (count === 0) {
        statusEl.textContent = "ã¾ãš4æšé¸ã‚“ã§ãã ã•ã„ã€‚";
        statusEl.className = "status err";
        return;
      }
      if (count !== 4) {
        statusEl.textContent =
          "ä»Šé¸æŠã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ¼ãƒ‰ã¯ " +
          count +
          " æšã§ã™ï¼ˆ4æšãšã¤è©¦ã—ã¦ãã ã•ã„ï¼‰ã€‚";
        statusEl.className = "status err";
        return;
      }

      var group = findMatchingGroup(selected);
      if (!group) {
        statusEl.textContent = "ãã®4æšã¯åŒã˜ã‚°ãƒ«ãƒ¼ãƒ—ã§ã¯ãªã„ã‚ˆã†ã§ã™ã€‚";
        statusEl.className = "status err";
        clearSelection(true);
        return;
      }

      if (solvedGroups[group.name]) {
        statusEl.textContent =
          "ãã®ã‚°ãƒ«ãƒ¼ãƒ—ã¯ã™ã§ã«å®Œæˆã—ã¦ã„ã¾ã™ã€‚";
        statusEl.className = "status err";
        clearSelection(true);
        return;
      }

      statusEl.textContent = "æ­£è§£ï¼ã€Œ" + group.name + "ã€";
      statusEl.className = "status ok";
      solvedGroups[group.name] = true;
      solveOrder.push(group.name); // æ­£è§£é †ã«è¿½åŠ 

      lockGroup(selected, group);   // ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã¤ãã§ãƒ­ãƒƒã‚¯
      clearSelection(false);

      var solvedCount = 0;
      for (var key in solvedGroups) {
        if (solvedGroups.hasOwnProperty(key) && solvedGroups[key]) {
          solvedCount++;
        }
      }
      if (solvedCount === CURRENT_PUZZLE.groups.length) {
        statusEl.textContent = "ğŸ‰ ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼å…¨ã‚°ãƒ«ãƒ¼ãƒ—æ­£è§£ã§ã™ã€‚";
        statusEl.className = "status ok";
        endTime = Date.now();
        showScoreCard();
      }
    });

    function findMatchingGroup(selectedWords) {
      for (var i = 0; i < CURRENT_PUZZLE.groups.length; i++) {
        var g = CURRENT_PUZZLE.groups[i];
        var items = g.items;
        if (items.length !== selectedWords.length) {
          continue;
        }
        var allMatch = true;
        for (var j = 0; j < items.length; j++) {
          if (selectedWords.indexOf(items[j]) === -1) {
            allMatch = false;
            break;
          }
        }
        if (allMatch) {
          return g;
        }
      }
      return null;
    }

    // ===== 9) ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ãƒ­ãƒƒã‚¯ã—ã¦ä¸Šã«ä¸¦ã¹æ›¿ãˆã‚‹ï¼‹è‰²ä»˜ã‘ =====
    function lockGroup(wordsToLock, group) {
      // ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ãŒä½•ç•ªç›®ã‹ï¼ˆ0ã€œ3ï¼‰ã‚’èª¿ã¹ã‚‹
      var groupIndex = -1;
      for (var gi = 0; gi < CURRENT_PUZZLE.groups.length; gi++) {
        if (CURRENT_PUZZLE.groups[gi].name === group.name) {
          groupIndex = gi;
          break;
        }
      }

      // ãƒ­ãƒƒã‚¯ãƒãƒƒãƒ—ã«ã€Œã‚°ãƒ«ãƒ¼ãƒ—ç•ªå·ã€ã‚’ä¿å­˜
      for (var i = 0; i < wordsToLock.length; i++) {
        var word = wordsToLock[i];
        lockedWords[word] = groupIndex;
      }

      // è§£ã‘ãŸã‚°ãƒ«ãƒ¼ãƒ—ã®å˜èªã‚’ä¸Šã«é›†ã‚ã‚‹
      var solvedWordsInOrder = [];
      for (var gi2 = 0; gi2 < CURRENT_PUZZLE.groups.length; gi2++) {
        var g = CURRENT_PUZZLE.groups[gi2];
        if (solvedGroups[g.name]) {
          for (var jj = 0; jj < g.items.length; jj++) {
            solvedWordsInOrder.push(g.items[jj]);
          }
        }
      }

      // ã¾ã ã®å˜èª
      var remaining = [];
      for (var wi = 0; wi < words.length; wi++) {
        var w = words[wi];
        if (solvedWordsInOrder.indexOf(w) === -1) {
          remaining.push(w);
        }
      }

      // æ–°ã—ã„ä¸¦ã³é †ã«å·®ã—æ›¿ãˆï¼†å†æç”»
      words = solvedWordsInOrder.concat(remaining);
      renderBoard();
    }

    function clearSelection(removeClass) {
      if (removeClass) {
        for (var i = 0; i < selected.length; i++) {
          var word = selected[i];
          var tile = findTile(word);
          if (tile) {
            tile.classList.remove("selected");
          }
        }
      }
      selected = [];
    }

    function findTile(word) {
      return boardEl.querySelector('.tile[data-word="' + word + '"]');
    }

    // ===== 10) ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ =====
    resetBtn.addEventListener("click", function () {
      initPuzzle();
      statusEl.textContent = "ãƒœãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚4æšãšã¤è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚";
      statusEl.className = "status";
    });

    // ===== 11) ã‚°ãƒ«ãƒ¼ãƒ—åãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒ’ãƒ³ãƒˆï¼‰ =====
    function renderGroupsPreview() {
      var html = '<div class="groups-view-title">ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆãƒ’ãƒ³ãƒˆï¼‰</div><ul>';
      for (var i = 0; i < CURRENT_PUZZLE.groups.length; i++) {
        html += "<li>" + CURRENT_PUZZLE.groups[i].name + "</li>";
      }
      html += "</ul>";
      groupsViewEl.innerHTML = html;
    }

    // ===== 12) ã‚¹ã‚³ã‚¢ã‚«ãƒ¼ãƒ‰è¡¨ç¤º =====
    function showScoreCard() {
      if (!endTime || !startTime) return;

      var durationMs = endTime - startTime;
      var totalSec = Math.floor(durationMs / 1000);
      var minutes = Math.floor(totalSec / 60);
      var seconds = totalSec % 60;
      var secStr = seconds < 10 ? "0" + seconds : "" + seconds;
      var timeText;
      if (minutes > 0) {
        timeText = minutes + "åˆ†" + secStr + "ç§’";
      } else {
        timeText = seconds + "ç§’";
      }

      scoreTitleEl.textContent = "Tech Connections â€“ " + todayLabel;
      scoreTimeEl.textContent = "ã‚¯ãƒªã‚¢æ™‚é–“: " + timeText;

      var lines = [];
      for (var i = 0; i < solveOrder.length; i++) {
        lines.push((i + 1) + ". " + solveOrder[i]);
      }
      scoreOrderEl.textContent = lines.join("\n");

      scoreCardEl.style.display = "block";
      scoreCardEl.setAttribute("aria-hidden", "false");
    }

    // ===== 13) ã‚·ã‚§ã‚¢ç”¨ç”»åƒç”Ÿæˆï¼ˆPNGãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰ =====
    shareBtn.addEventListener("click", function () {
      if (!endTime) {
        return;
      }

      var canvas = document.createElement("canvas");
      canvas.width = 800;
      canvas.height = 418;
      var ctx = canvas.getContext("2d");

      // èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      var grad = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      grad.addColorStop(0, "#020617");
      grad.addColorStop(0.5, "#1e293b");
      grad.addColorStop(1, "#0f172a");
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // ã‚¢ã‚¯ã‚»ãƒ³ãƒˆä¸¸
      var radial = ctx.createRadialGradient(650, 60, 20, 650, 60, 180);
      radial.addColorStop(0, "rgba(96, 165, 250, 0.9)");
      radial.addColorStop(1, "rgba(15, 23, 42, 0)");
      ctx.fillStyle = radial;
      ctx.beginPath();
      ctx.arc(650, 60, 180, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "#e5e7eb";
      ctx.font = "22px -apple-system, system-ui, sans-serif";
      ctx.fillText("Tech Connections â€“ " + todayLabel, 40, 60);

      ctx.font = "24px -apple-system, system-ui, sans-serif";
      ctx.fillText(CURRENT_PUZZLE.title, 40, 100);

      // ã‚¯ãƒªã‚¢æ™‚é–“
      var durationMs = endTime - startTime;
      var totalSec = Math.floor(durationMs / 1000);
      var minutes = Math.floor(totalSec / 60);
      var seconds = totalSec % 60;
      var secStr = seconds < 10 ? "0" + seconds : "" + seconds;
      var timeText;
      if (minutes > 0) {
        timeText = minutes + "åˆ†" + secStr + "ç§’";
      } else {
        timeText = seconds + "ç§’";
      }

      ctx.font = "18px -apple-system, system-ui, sans-serif";
      ctx.fillStyle = "#bfdbfe";
      ctx.fillText("ã‚¯ãƒªã‚¢æ™‚é–“: " + timeText, 40, 140);

      // æ­£è§£é †
      ctx.fillStyle = "#e5e7eb";
      ctx.font = "16px -apple-system, system-ui, sans-serif";
      ctx.fillText("æ­£è§£é †:", 40, 180);

      ctx.font = "15px -apple-system, system-ui, sans-serif";
      var y = 210;
      for (var i = 0; i < solveOrder.length; i++) {
        ctx.fillText((i + 1) + ". " + solveOrder[i], 60, y);
        y += 26;
      }

      ctx.font = "13px -apple-system, system-ui, sans-serif";
      ctx.fillStyle = "#9ca3af";
      ctx.fillText("Generated with Tech Connections", 40, canvas.height - 30);

      var dataUrl = canvas.toDataURL("image/png");
      var link = document.createElement("a");
      link.href = dataUrl;
      link.download = "tech-connections-score.png";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // ===== 14) ã‚·ãƒ£ãƒƒãƒ•ãƒ«é–¢æ•° =====
    function shuffle(arr) {
      var a = arr.slice();
      for (var i = a.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = a[i];
        a[i] = a[j];
        a[j] = temp;
      }
      return a;
    }

    // ===== 15) Service Worker ç™»éŒ²ï¼ˆPWAç”¨ï¼‰ =====
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker
          .register("service-worker.js")
          .catch(function (err) {
            console.log("SW registration failed:", err);
          });
      });
    }

    // åˆæœŸåŒ–
    initPuzzle();
  </script>
</body>
</html>

